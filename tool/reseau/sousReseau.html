<!-- Generated by Copilot -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/js/lib/alert.js"></script>

    <title>createur de sous-reseaux</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .form {
            display: flex;
            flex-direction: column;
            border: black 1px solid;
            border-radius: 10px;
            margin: 10px;
            padding: 5px;
        }
        label {
            margin: 10px;
            color: #555;
        }
        input, select {
            margin: 0 10px;
            padding: 10px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #0056b3;
        }
        a {
            color: #333;
            font-weight: bold;
        }
        #output {
            margin: 10px;
        
        }
        .subReseau {
            border: 1px solid #383838;
            border-radius: 10px;
            padding: 10px;
            overflow: hidden;
            display: flex;
            align-content: center;
            flex-wrap: nowrap;
            flex-direction: column;
        }
        .contentSubReseau {
            max-height: 0; /* Départ fermé */
            /* overflow: hidden; */
            transition: max-height 0.5s;
            
        }
        .concealedInput:checked+div .contentSubReseau {
            max-height: 500px; /* Fixe une valeur maximale approximative */
        }
        .displayMore {
            cursor: pointer;
            color: #007BFF;
        }
        .displayMore:before {
            content: '';
            /* Generated by Nyapilot */
            /* Ajoute une flèche avant le texte */
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid #007BFF;
            margin-right: 5px;
            transform: rotate(-90deg) translateX(5px) scale(1.5) translateY(0);
            transition: all 0.5s;
        }
        .concealedInput:checked+div .displayMore:before {
            transform: rotate(0deg) translateX(0) translateY(-5px) scale(1.5)
        }
        .displayMore h2 {
            display: inline;
        }
        span.coppy {
            font-weight: bold;
            border: 1px solid #383838;
            border-radius: 5px;
            padding: 5px;
            cursor: pointer;
            position: relative;
        }
        span.coppy:hover:before {
            content: 'Copier';
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
            margin-left: 10px;
            top: -30px;
            z-index: 10000;
        }
        .contentSubReseau span.reseau {
            color: #4400ff;
        }
        .contentSubReseau span.hote {
            color: #00721b;
        }
        .contentSubReseau span.fin {
            color: #b10012;
        }
        .contentSubReseau span.diffusion {
            color: #d8b000;
        }
        .numSubnet{
            color: #1eff00;
            background-color: #000;
            height: 30px;
            width: 30px;
            display: inline-block;
            text-align: center;
            border-radius: 15%;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/tool/reseau/index.html">retour au outils réseau</a>
        <h1>Créateur de sous-réseaux</h1>
        <div class="form">
            <label for="ip">Adresse IP et le masque</label>
            <input type="text" name="ip" id="ip" placeholder="10.0.0.1/8" required value="10.0.0.1/8">
            <label for="nb">Nombre de sous-réseaux</label>
            <input type="number" name="nb" id="nb" min="1" max="28" required value="2">
            <button type="button" class="button" id="create">Créer</button>
        </div>
        <div id="output">

        </div>

</div>
<script>
    //parcours des éléments du formulaire
    let subnets = [];

    document.querySelector('#create').addEventListener('click', function() {
        let ipPart = document.getElementById('ip').value;
        let nb = document.getElementById('nb').value;
        console.log(ipPart, nb);
        //verifie l'entrée utilisateur
        if (!ipPart) {
            alert('Veuillez entrer une adresse IP et un masque (ex: 10.0.0.1/8)');
            return;
        }
        if (!nb) {
            alert('Veuillez entrer un nombre de sous-réseaux');
            return;
        }
        if (isNaN(nb)) {
            alert('Le nombre de sous-réseaux doit être un nombre');
            return;
        }
        nb = parseInt(nb);
        if (nb < 1) {
            alert('Le nombre de sous-réseaux doit être supérieur à 0');
            return;
        }
        if (!ipPart.includes('/') || !ipPart.split(' ')) {
            alert('Veuillez entrer une adresse IP et un masque valide (ex: 10.0.0.1/8)');
            return;
        }
        //récupération de l'adresse IP et du masque
        let mask = ipPart.split('/')[1];
        ip = ipPart.split('/')[0].split(' ')[0].split('.').map(function(e) {
            return parseInt(e);
        });
        if (!mask) {
            mask = ipPart.split(' ')[1];
            mask = mask.split('.');
            let cidr = 0;
            for (let i = 0; i < mask.length; i++) {
                let bin = parseInt(mask[i]).toString(2);
                cidr += bin.split('1').length - 1;
            }
            mask = cidr;
        }
        mask = parseInt(mask);
        console.log(ip, mask);
        //test le masque et l'adresse IP pour vérifier si c'est valide
        if (mask < 0 || mask > 32) {
            alert('Le masque doit être compris entre 0 et 32');
            return;
        }
        if (ip.length !== 4) {
            alert('L\'adresse IP doit être composée de 4 octets');
            return;
        }
        for (let i = 0; i < ip.length; i++) {
            if (ip[i] < 0 || ip[i] > 255) {
                alert('Chaque octet de l\'adresse IP doit être compris entre 0 et 255');
                return;
            }
        }
        //calcul du nombre de bits pour les sous-réseaux
        const nbBitsSB = Math.ceil(Math.log2(nb));
        console.log(nbBitsSB);
        //verifie si il y a assez de bits pour le nombre de sous-réseaux
        if (mask + nbBitsSB > 32) {
            alert('Pas assez de bits pour le nombre de sous-réseaux');
            return;
        }
        //calcul du masque de sous-réseaux
        const maskSubnet = mask + nbBitsSB;
        console.log("/"+maskSubnet);
        //conversion de l'adresse IP en binaire
        let ipBinary = ipToBinary(...ip)
        console.log(ipBinary);
        //calcul des sous-réseaux
        for (let i = 0; i < nb; i++) {
            //calcul de l'adresse du sous-réseau
            //récupération du net et met le en sécurité
            const net = ipBinary.slice(0, mask);
            //crée la parie sous réseau
            const subnet = parseInt(i).toString(2).padStart(nbBitsSB, '0');
            const adrReseau = net.join('') + subnet+'0'.repeat(32 - mask - nbBitsSB);
            //calcul de l'adresse du 1er hôte
            const adrHote = net.join('') + subnet+'0'.repeat(31 - mask - nbBitsSB) + '1'
            //calcul de l'adresse de fin
            const adrFin = net.join('') + subnet+'1'.repeat(31 - mask - nbBitsSB) + '0'
            //calcul de l'adresse de diffusion
            const adrDiffusion = net.join('') + subnet+'1'.repeat(32 - mask - nbBitsSB);
            //ajoute le sous-réseau à la liste
            subnets.push({
                reseau: binaryToIp(adrReseau.split('').map(function(e) {
                    return parseInt(e);
                })),
                hote: binaryToIp(adrHote.split('').map(function(e) {
                    return parseInt(e);
                })),
                fin: binaryToIp(adrFin.split('').map(function(e) {
                    return parseInt(e);
                })),
                diffusion: binaryToIp(adrDiffusion.split('').map(function(e) {
                    return parseInt(e);
                })),
            });
            
        }
        console.log(subnets);
        //affiche les sous-réseaux dans le html
        //conevrte le masque en adresse IP
        let maskSubnetIP = ""
        for (let i = 0; i < 4; i++) {
            maskSubnetIP += parseInt(maskSubnet / 8) > i ? '255' : parseInt(maskSubnet / 8) === i ? (255 << (8 - maskSubnet % 8)) & 255 : '0';
            maskSubnetIP += i < 3 ? '.' : '';
        }
        let html = `
                <p>Adresse IP: <span class="coppy" onclick="copyToClipboard('${ipPart}')">${ipPart}</span></p>
                <p>Nombre de sous-réseaux: <span class="coppy" onclick="copyToClipboard('${nb}')">${nb}</span></p>
                <p>Nouveau masque: <span class="coppy" onclick="copyToClipboard('${maskSubnet}')">${maskSubnet}</span> <span class="coppy" onclick="copyToClipboard('${maskSubnetIP}')">(${maskSubnetIP})</span></p>
                <p>Sous-réseaux créés:</p>
        `;
        function displaySubnet(subnet, i) {
            return `
            <input type="checkbox" id="subReseau${i}" class="concealedInput" style="display: none">
            <div class="subReseau">
                <label for="subReseau${i}" class="displayMore">
                    <h2><span class="numSubnet">${i + 1}</span> ${subnet.reseau}</h2>
                </label>
                <div class="contentSubReseau">
                    <p>Adresse réseau: <span class="reseau coppy" onclick="copyToClipboard('${subnet.reseau}')">${subnet.reseau}</span></p>
                    <p>Adresse 1er hôte: <span class="hote coppy" onclick="copyToClipboard('${subnet.hote}')">${subnet.hote}</span></p>
                    <p>Adresse dernier hôte: <span class="fin coppy" onclick="copyToClipboard('${subnet.fin}')">${subnet.fin}</span></p>
                    <p>Adresse de broadcast: <span class="diffusion coppy" onclick="copyToClipboard('${subnet.diffusion}')">${subnet.diffusion}</span></p>
                </div>
            </div>
            `
        }
        for (let i = 0; i < subnets.length; i++) {
            html += displaySubnet(subnets[i], i);
        }
        html += `
        <h1><span class="coppy" onclick="copyToClipboard('JSONDATA')">Copier au format JSON</span></h1>
        `
        document.getElementById('output').innerHTML = html;
        //affiche les sous-réseaux dans le html
    });
    //script magique généré par chatGPT
    function ipToBinary(oc1, oc2, oc3, oc4) {
        // Sépare l'adresse IP en octets (en utilisant les points)
        let octets = [oc1, oc2, oc3, oc4];

        // Convertir chaque octet en binaire avec padding de 8 bits
        let binaryOctets = octets.map(function(octet) {
            return ('00000000' + parseInt(octet, 10).toString(2)).slice(-8);
        });
        // Retourner les octets binaires sous forme de chaîne séparée par des points
        return binaryOctets.join('').split('').map(function(e) {
            return parseInt(e);
        });
    }

    //function pour convertir une adresse binnaire en décimal
    function binaryToIp(binary) {
        // Convertir la chaîne binaire en tableau de 8 bits
        //binary est un tableau de 0 et de 1
        let octets = binary.join('').match(/.{1,8}/g);

        // Convertir chaque octet en décimal
        let decimalOctets = octets.map(function(octet) {
            return parseInt(octet, 2);
        });

        // Retourner les octets décimaux sous forme de chaîne séparée par des points
        return decimalOctets.join('.');
    }
    //fonction pour copier dans le presse-papier
    function copyToClipboard(text) {
        if (text === 'JSONDATA') {
            text = JSON.stringify(subnets);
        }
        //crée un élément textarea
        let textarea = document.createElement('textarea');
        //ajoute le texte à copier
        textarea.value = text;
        //ajoute l'élément au document
        document.body.appendChild(textarea);
        //sélectionne le texte
        textarea.select();
        //copie le texte
        document.execCommand('copy');
        //supprime l'élément
        document.body.removeChild(textarea);
        //affiche un message
        console.log(text);
        alert('Texte copié dans le presse-papier');
    }
</script>
</body>
</html>